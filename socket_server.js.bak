const io = require("socket.io")();

io.on("connection", client => {
  console.log("user connected");

  client.on("here", () => console.log("here"));

  client.on("typing", data => {
    console.log("typing");
    client.broadcast.emit("notifyTyping", {
      user: data.currentUser,
      message: data.message
    });
  });

  client.on("newMessage", function () {
    //broadcast message to everyone in port:8000 except yourself.
    client.broadcast.emit("received");

  });

});

const port = 8000;
io.listen(port);
console.log("listening on port", port);


// // sockets ---------------------------------------------------------------------
// const io = require("socket.io")();

// //setup event listener
// io.on("connection", socket => {
//   console.log("user connected");

//   io.on("here", socket => (console.log("yes")));

//   io.on("disconnect", function () {
//     console.log("user disconnected");
//   });

//   //Someone is typing
//   io.on("typing", data => {
//     io.broadcast.emit("notifyTyping", {
//       user: data.user,
//       message: data.message
//     });
//   });

//   // //when soemone stops typing
//   // io.on("stopTyping", () => {
//   //   io.broadcast.emit("notifyStopTyping");
//   // });

//   io.on("chat message", function (msg) {
//     console.log("message: " + msg);

//     //broadcast message to everyone in port:8000 except yourself.
//     io.broadcast.emit("received", { message: msg });

//     //save chat to the database
//     // connect.then(db => {
//     //   console.log("connected correctly to the server");
//     //   let chatMessage = new Chat({ message: msg, sender: "Anonymous" });

//     //   chatMessage.save();
//     // });
//   });
// });

// const socketPort = 8000;
// io.listen(socketPort);
// console.log("listening on port", socketPort);

